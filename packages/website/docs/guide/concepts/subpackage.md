---
title: 分包策略
order: 4
---

## 规则

核心规则为最大限度的保证主包体积最小，因此 mpbuild 会按照 entry 分析整个依赖树

-   分析到主包有使用的文件(组件)，相关文件会打包到主包中
-   分析到只有分包使用的文件(组件)，相关文件会自动打包到对应分包中

## 注意

按照上述分包策略会有一个问题，一个 js 文件如果有两个分包都在使用，按照小程序规范只有放到主包中才能让两个文件都依赖到，但是为了降低主包大小，这里会将这个 js 文件分别打包到两个分包中，所以 js 文件一定要是无副作用的，也就是不能依赖 js 文件中的局部变量进行状态的共享，通常这个策略不会造成问题，因为如果想 tree-shaking 生效也必须有这样的约束。

一旦有共享的变量，需要有意识的放到主包依赖的 js 中，比如单独声明一个 `single.js` 来进行状态共享
